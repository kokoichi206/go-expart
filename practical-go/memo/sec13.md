## テスト

- `xxx_test.go` というファイル名
  - helper 関数もここに記載
    - helper_test.go
  - ビルドから除外される
- パッケージ名はフォルダと同じ or `_test` をつけたもの
- `TestXxx` という関数名
- Table Driven Test
- `testXxx` というパッケージをきる
  - テストコードからしか import しなければ、プロダクションコードのビルドには含まれない！
  - 共通するヘルパー関数を定義できる！

## ウェブサーバー

- Java 全盛期のアーキテクチャは、特定のフレームワークへの依存を減らし、いつでも乗り換えるためのもの
- Go は標準ライブラリの薄いラッパーであることが多く、どれを使っても大差ない
- 特定のフレームワークから独立させるためのレイヤーを手作りするメリットがあまりない
  - そうなのか
- 特定のフレームワークへの依存を除去したアーキテクチャで実現したことの1つがテスト
  - Go ではフレームワークの外側からリクエストを送信する仕組みが言語に備わっている！
- E2E test
  - `net/http/httptest`

## Tips

- テストは順番に依存するべきではない！
  - Go 1.17 からはテストの順番をシャッフルできるようになった！
    - これは常に利用するのが良い
  - `go test -shuffle=on`
- キャッシュの削除
  - テスト実行時のデータを外部ファイル化していてデータだけを修正した場合など
  - `go test . -count=1`
- 特定テストのみ実行
  - `go test -run Model`
    - Model が含まれている関数名のテストのみ
  - `go test -short`
- 構造体の比較など
  - testify
  - go-cmp
    - https://github.com/google/go-cmp
    - `reflect/DeepEqual()` の代替になる
- 入出力先が、ファイル・外部サーバーとの TCP によるネットワークに限られていたとしても、あえて io.Reader などに依存した設計にする、といいかも！
- DATA-DOG/go-sqlmock
- error 処理の都合上、カバレッジ 100% は難しいだろう
  - Google のブログでは 60% が許容, 75% が推奨と書かれている
